<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Emotion Detection App</h1>
        <p>Upload a photo or use your camera!</p>

        <input type="text" id="name" placeholder="Enter your name" required>
        <br><br>

        <!-- Upload Image -->
        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" id="fileInput" accept="image/*">
            <button type="button" onclick="uploadImage()">Upload & Detect</button>
        </form>

        <hr>

        <!-- Upload -->
<input type="file" id="fileInput" accept="image/*">
<button type="button" onclick="uploadImage()">Upload & Detect</button>

<!-- Camera -->
<video id="video" width="320" height="240" autoplay></video>
<canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
<button type="button" onclick="takePhoto()">Take Photo & Detect</button>

<h2 id="result" style="min-height:50px;"></h2>
    </div>

  <script>
    // Camera
    const video = document.getElementById('video');
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => video.srcObject = stream)
        .catch(err => alert("Camera error: " + err.message));

    // Upload
    function uploadImage() {
        const file = document.getElementById('fileInput').files[0];
        const name = document.getElementById('name').value.trim();
        if (!name) return alert("Enter your name!");
        if (!file) return alert("Choose an image!");

        const formData = new FormData();
        formData.append('file', file);
        formData.append('name', name);

        fetch('/predict', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => showResult(data))
        .catch(err => alert("Network error: " + err));
    }

    // Camera
    function takePhoto() {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, 320, 240);
        const imageData = canvas.toDataURL('image/jpeg');

        const name = document.getElementById('name').value.trim();
        if (!name) return alert("Enter your name!");

        const formData = new FormData();
        formData.append('image', imageData);
        formData.append('name', name);

        fetch('/predict', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => showResult(data))
        .catch(err => alert("Network error: " + err));
    }

    // Show result
    function showResult(data) {
        const result = document.getElementById('result');
        if (data.emotion) {
            result.innerHTML = `<strong>${data.name || 'User'}, you look: <span style="color: #ff6b6b;">${data.emotion}</span>!</strong>`;
        } else {
            result.innerHTML = `<span style="color: red;">Error: ${data.error}</span>`;
        }
    }
</script>
</body>
</html>
